"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();!function(){var e="https://api.github.com/search/repositories",t="https://api.github.com/gists",i="https://api.github.com/user",s={q:"",sort:"",order:"asc"},n=document.querySelector(".rep-search"),r=document.getElementById("rep-template").innerHTML,o=document.querySelector(".rep-content"),a=document.getElementById("gist-template").innerHTML,u=document.querySelector(".gist__link"),l=document.querySelector(".gist__form"),c=document.getElementById("profile-template").innerHTML,h=document.querySelector(".profile"),f=document.querySelector(".auth-block"),m={form:document.forms.authForm,profile:{image:document.querySelector(".profile__image"),name:document.querySelector(".profile__name"),btnLogout:document.querySelector(".profile__logout")}},d=function(){function e(t,i,s){_classCallCheck(this,e),this.input=t,this.url=i,this.params=s,this.request()}return _createClass(e,[{key:"request",value:function(){var e=new XMLHttpRequest,t=this,i=function(e){var t="?";return _.forEach(e,function(e,i){""!==e&&(t+=i+"="+e+"&")}),t};this.input.addEventListener("keyup",function(s){this.value.length>3&&(t.params.q=this.value,e.open("GET",""+t.url+i(t.params)),k.isAutorized&&e.setRequestHeader("Authorization","Basic "+k.keyBase64),e.send())}),this.input.addEventListener("keydown",function(t){e.abort()}),e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText).items.slice(0,3);v.render(e)}}}}]),e}(),p=function(){function e(t,i){_classCallCheck(this,e),this.form=t,this.url=i,this.form.onsubmit=this.submitControl.bind(this)}return _createClass(e,[{key:"submitControl",value:function(e){e.preventDefault();var t=new XMLHttpRequest,i=this.form.gistName.value,s=this.form.gistContent.value,n=this.gistSendObj(i,s);t.open("POST",""+this.url),k.isAutorized&&t.setRequestHeader("Authorization","Basic "+k.keyBase64),t.send(JSON.stringify(n)),t.onreadystatechange=function(){if(4==this.readyState){if(201!=this.status)return void console.warn("ошибка: "+(this.status?this.statusText:"запрос не удался"));var e=JSON.parse(this.responseText);b.render(e)}}}},{key:"gistSendObj",value:function(e,t){return{files:_defineProperty({},e,{content:t})}}}]),e}(),g=function(){function e(t){_classCallCheck(this,e),this.options=t,this.form=t.form,this.login=t.form.login,this.password=t.form.password,this.profileImage=t.profile.image,this.profileName=t.profile.name,this.isAutorized=null,this.form.onsubmit=this.formSubmit.bind(this)}return _createClass(e,[{key:"formSubmit",value:function(e){e.preventDefault(),null===this.login&&(this.login=this.options.login,this.password=this.options.password),this.keyBase64=window.btoa(this.login.value+":"+this.password.value);var t=new XMLHttpRequest,s=this;t.open("GET",""+i),t.setRequestHeader("Authorization","Basic "+this.keyBase64),t.send(),t.onreadystatechange=function(){if(4==this.readyState){if(200!=this.status)return void console.warn("ошибка: "+(this.status?this.statusText:"запрос не удался"));s.isAutorized=!0;var e=JSON.parse(this.responseText);w.render(e),f.classList.add("auth-block--authorized"),s.btnLogout=document.querySelector(".profile__logout"),s.btnLogout.onclick=s.logout.bind(s)}}}},{key:"logout",value:function(){f.classList.remove("auth-block--authorized"),this.keyBase64=null,this.isAutorized=null}}]),e}(),y=function(){function e(t){var i=arguments.length<=1||void 0===arguments[1]?"":arguments[1];_classCallCheck(this,e),this.elem=t,this.template=i}return _createClass(e,[{key:"render",value:function(e){var t=_.template(this.template);this.elem.innerHTML=t({items:e})}}]),e}(),v=(new d(n,e,s),new y(o,r)),b=(new p(l,t),new y(u,a)),k=new g(m),w=new y(h,c)}();